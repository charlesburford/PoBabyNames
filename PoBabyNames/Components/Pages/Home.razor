@page "/"
@using Microsoft.EntityFrameworkCore
@using PoBabyNames.Data
@using PoBabyNames.Models
@inject DataImportService DataImportService
@inject ApplicationDbContext DbContext

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

<button @onclick="ImportData" disabled="@isImporting">Import Data</button>

@if (isImporting)
{
    <p><em>Importing data...</em></p>
}
else if (importMessage != null)
{
    <p>@importMessage</p>
}

@* <RadzenGrid Data="@names" TItem="Name" ColumnWidth="auto" Style="width:100%; height: 500px;">
       <Columns>
           <RadzenGridColumn TItem="Name" Property="NameText" Title="Name" />
           <RadzenGridColumn TItem="Name" Property="Sex" Title="Sex" />
           <RadzenGridColumn TItem="Name" Property="YearInvented" Title="Year Invented" />
           <RadzenGridColumn TItem="Name" Property="AverageRating" Title="Average Rating" />
       </Columns>
   </RadzenGrid> *@


@code {
    private bool isImporting = false;
    private string importMessage;

    List<Name> names = new List<Name>();

    protected override async Task OnInitializedAsync()
    {
        names = await DbContext.Names
            .Where(n => DbContext.Ratings
                .Where(r => r.NameId == n.Id)
                .GroupBy(r => r.GroupId)
                .All(g => g.Count() == DbContext.Groups.Count()))
            .ToListAsync();
    }

    private async Task ImportData()
    {
        isImporting = true;
        importMessage = null;
        try
        {
            await DataImportService.ImportCsvDataAsync();
            importMessage = "Data imported successfully!";
        }
        catch (Exception ex)
        {
            importMessage = $"An error occurred: {ex.Message}";
        }
        isImporting = false;
    }
}